<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>heliyang blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="/hly.github-io/assets/css/main.css">
    <link rel="stylesheet" href="/hly.github-io/assets/css/mobile.css">
    <link rel="stylesheet" href="/hly.github-io/assets/css/vendor/syntax.css">
    <link rel="stylesheet" href="/hly.github-io/assets/css/vendor/semantic.min.css"/>

    <link rel="shortcut icon" type="image/png" href="/hly.github-io/assets/img/tutu.png"/>
    
</head>

<body>
    
    <div class="page-wrap">
        <div class="header-wrapper">
    <header>
        <!-- logo and description -->
        
        <nav class="site-nav">
            <div class="left-nav">
                <!-- add titles to all buttons -->
                <div class="ui secondary menu inverted">
                    <a class="item" href="/hly.github-io/">
                        主页
                    </a>
                    <a class="item" href="/hly.github-io/about.html">
                        关于
                    </a>
                    
                    <a class="item" href="/hly.github-io/archive">
                        笔记
                    </a>
                    <div class="right menu">
                        <a class="item" href="#">
                            <i class="facebook link icon"></i>
                        </a>
                        <a class="item" href="#">
                            <i class="github link icon"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="right-nav"></div>
        </nav>
    </header>
</div>
        <main>
            <div class="post-container">
    <center>
        <span class="date">
            19 Sep 2018 
             
                in <i>java爬虫</i>
             
        </span>
        <h1 class="post-title">Java爬虫入门（二）</h1>
    </center>
    <div class="ui divider"></div>
    <p>环境：JDK 10.0.2</p>

<p>IDE： Eclipse</p>

<h3 id="简介">简介</h3>
<p>在上一篇文章中介绍了爬虫的一些准备工作，那么现在开始编写爬虫代码</p>

<h3 id="page类">Page类</h3>
<p>Page类用来保存网页的一些信息，比如分别以字节形式和字符串形式存储的网页内容、网页的Document对象、字符编码、url等信息，代码如下：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">;</span>  <span class="c1">//以byte形式存储的内容      </span>
        <span class="kd">private</span> <span class="n">Document</span> <span class="n">doc</span>  <span class="o">;</span><span class="c1">//网页的Document对象</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">charset</span> <span class="o">;</span><span class="c1">//字符集编码</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">url</span> <span class="o">;</span><span class="c1">//url</span>
</code></pre></div></div>
<p>建立<em>Page</em>类的构造函数：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="nf">Page</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span> <span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>因为在<em>Page</em>类中成员变量都是私有变量，所以为了获得这些变量，需要写一些get形式的成员函数：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCharset</span><span class="o">(){</span><span class="k">return</span> <span class="n">charset</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUrl</span><span class="o">(){</span><span class="k">return</span> <span class="n">url</span> <span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">(){</span> <span class="k">return</span> <span class="n">content</span> <span class="o">;}</span>
</code></pre></div></div>
<p>除了这几个外，比较关键的是获取<em>Document</em>对象，要想获取正确的内容，就要知道正确的编码，在上一节已经说明了可以借助<em>UniversalDetector</em>类中的方法来获取，所以先定一个获取编码的函数getEncoding()：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEncoding</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">DEFAULT_ENCODING</span> <span class="o">=</span> <span class="s">"UTF-8"</span><span class="o">;</span>
        <span class="n">UniversalDetector</span> <span class="n">detector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UniversalDetector</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">detector</span><span class="o">.</span><span class="na">handleData</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">bytes</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="n">detector</span><span class="o">.</span><span class="na">dataEnd</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="na">getDetectedCharset</span><span class="o">();</span>
        <span class="n">detector</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">encoding</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="n">DEFAULT_ENCODING</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">encoding</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>然后就可以编写getDoc()函数了</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">Document</span> <span class="nf">getDoc</span><span class="o">(){</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">doc</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">doc</span><span class="o">;</span>
    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">charset</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
            <span class="n">charset</span> <span class="o">=</span> <span class="n">getEncoding</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">content</span><span class="o">,</span> <span class="n">charset</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">doc</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><em>Page</em>类最后是这样的:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.jsoup.Jsoup</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.jsoup.nodes.Document</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">;</span>
        <span class="kd">private</span> <span class="n">Document</span> <span class="n">doc</span>  <span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">charset</span> <span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">url</span> <span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Page</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span> <span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCharset</span><span class="o">(){</span><span class="k">return</span> <span class="n">charset</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUrl</span><span class="o">(){</span><span class="k">return</span> <span class="n">url</span> <span class="o">;}</span>
        <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">(){</span> <span class="k">return</span> <span class="n">content</span> <span class="o">;}</span>
        <span class="kd">public</span> <span class="n">Document</span> <span class="nf">getDoc</span><span class="o">(){</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">doc</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">doc</span><span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">charset</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                    <span class="n">charset</span> <span class="o">=</span> <span class="n">getEncoding</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
                <span class="o">}</span>   
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">content</span><span class="o">,</span> <span class="n">charset</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">doc</span><span class="o">;</span>
                    <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<h3 id="links类">Links类</h3>
<p><em>Links</em>类用来保存各种链接，比如已经访问过的网页链接、未访问过的网址链接、图片链接、各种文件链接等，当然不介意的话不必写这个类，直接把存放各种链接的Set集合放到主类中也未尝不可，但是这样不够优雅QAQ，如果以后不断增加新的集合，程序就会显得十分臃肿，也不好维护。这个类很好写，首先也是定义一下私有变量：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Set</span> <span class="n">visitedUrlSet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">();</span>   <span class="c1">//访问过的链接地址</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">LinkedList</span> <span class="n">unVisitedUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>  <span class="c1">//未访问过的链接地址</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">LinkedList</span> <span class="n">unVisitedImgUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>   <span class="c1">//未访问过的图片链接</span>
</code></pre></div></div>
<p>然后是一些很简单的函数定义：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">//获取以访问链接的地址</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getVisitedUrlNum</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">visitedUrlSet</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//把地址添加到已访问地址集合</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addVisitedUrlSet</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">visitedUrlSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//把地址加入到未访问的地址队列</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addUnvisitedUrlQueue</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">url</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>  <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">visitedUrlSet</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>  <span class="o">&amp;&amp;</span> <span class="o">!</span>        <span class="n">unVisitedUrlQueue</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">url</span><span class="o">)){</span>
            <span class="n">unVisitedUrlQueue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//获取未访问地址队列的首个链接</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">removeHeadOfUnVisitedUrlQueue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">unVisitedUrlQueue</span><span class="o">.</span><span class="na">removeFirst</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//查看未访问地址是否为空</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">unVisitedUrlQueueIsEmpty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">unVisitedUrlQueue</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div></div>

<h3 id="requestandhandle类">RequestAndHandle类</h3>
<p>这个类用来向网页发送请求和处理得到的结果，在上一节已经说明了使用apache.commons.httpclient包来发送请求和处理得到的结果。所以直接给出代码：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.DefaultHttpMethodRetryHandler</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.HttpClient</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.HttpException</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.HttpStatus</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.methods.GetMethod</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.params.HttpMethodParams</span><span class="o">;</span>

    <span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestAndResponse</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">Page</span> <span class="nf">sendRequstAndGetResponse</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="o">();</span>        <span class="c1">// 生成 HttpClinet 对象</span>
            <span class="n">httpClient</span><span class="o">.</span><span class="na">getHttpConnectionManager</span><span class="o">().</span><span class="na">getParams</span><span class="o">().</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>  <span class="c1">// 设置连接超时 5s</span>
            <span class="n">GetMethod</span> <span class="n">getMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetMethod</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
            <span class="n">getMethod</span><span class="o">.</span><span class="na">getParams</span><span class="o">().</span><span class="na">setParameter</span><span class="o">(</span><span class="n">HttpMethodParams</span><span class="o">.</span><span class="na">SO_TIMEOUT</span><span class="o">,</span> <span class="mi">5000</span><span class="o">);</span>        <span class="c1">// 设置请求超时 5s</span>
            <span class="n">getMethod</span><span class="o">.</span><span class="na">getParams</span><span class="o">().</span><span class="na">setParameter</span><span class="o">(</span><span class="n">HttpMethodParams</span><span class="o">.</span><span class="na">RETRY_HANDLER</span><span class="o">,</span> <span class="k">new</span> <span class="n">DefaultHttpMethodRetryHandler</span><span class="o">());</span>        <span class="c1">// 设置请求重试处理</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">executeMethod</span><span class="o">(</span><span class="n">getMethod</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">statusCode</span> <span class="o">!=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Method failed: "</span> <span class="o">+</span> <span class="n">getMethod</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">getMethod</span><span class="o">.</span><span class="na">getResponseBody</span><span class="o">();</span><span class="c1">// 读取为字节 数组</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span><span class="n">responseBody</span><span class="o">,</span><span class="n">url</span><span class="o">);</span> <span class="c1">//封装成为页面</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">HttpException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span><span class="c1">// 处理异常</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">getMethod</span><span class="o">.</span><span class="na">releaseConnection</span><span class="o">();</span>        <span class="c1">// 释放连接</span>
            <span class="o">}</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<h3 id="spider类">Spider类</h3>
<p>首先来写一下保存网页的函数savePage()：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Page</span> <span class="n">page</span><span class="o">,</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getUrl</span><span class="o">();</span> <span class="c1">//把链接名作为文件名</span>
        <span class="n">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="err">“</span><span class="o">/</span><span class="err">”</span><span class="o">+</span><span class="n">fileName</span><span class="o">;</span> <span class="c1">//存放的地址</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span> <span class="c1">//获得内容</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">DataOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">)));</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
            <span class="o">}</span>
            <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件"</span><span class="o">+</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s">"已经存放在"</span><span class="o">+</span> <span class="n">filePath</span>  <span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>然后是地址初始化函数initSeeds()，开始先设置几个种子地址，然后从这几个地址开始去爬取网页</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initCrawlerWithSeeds</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">seeds</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">seeds</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
        <span class="n">Links</span><span class="o">.</span><span class="na">addUnvisitedUrlQueue</span><span class="o">(</span><span class="n">seeds</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>接着是getLinks()方法，这个方法获取该页面内所有图片链接:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLinks</span><span class="o">(</span><span class="n">Page</span> <span class="n">page</span><span class="o">){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">links</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">;</span> 
        <span class="n">Elements</span> <span class="n">element</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="na">getDoc</span><span class="o">().</span><span class="na">select</span><span class="o">(</span><span class="s">"img[src]"</span><span class="o">);</span>      
        <span class="n">Iterator</span> <span class="n">iterator</span>  <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span> 
            <span class="n">Element</span> <span class="n">element</span> <span class="o">=</span> <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"element.text() get:"</span><span class="o">+</span><span class="n">element</span><span class="o">.</span><span class="na">text</span><span class="o">()+</span><span class="s">":"</span><span class="o">+</span><span class="n">element</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"abs:src"</span><span class="o">));</span>
            <span class="n">links</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"abs:src"</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">links</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>最后是爬取函数，这个函数需要设置保存路径path：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">crawling</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">seeds</span><span class="o">,</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initCrawlerWithSeeds</span><span class="o">(</span><span class="n">seeds</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">Links</span><span class="o">.</span><span class="na">unVisitedUrlQueueIsEmpty</span><span class="o">()</span>  <span class="o">&amp;&amp;</span> <span class="n">Links</span><span class="o">.</span><span class="na">getVisitedUrlNum</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>  
            <span class="k">try</span><span class="o">{</span>
                <span class="n">String</span> <span class="n">visitUrl</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">Links</span><span class="o">.</span><span class="na">removeHeadOfUnVisitedUrlQueue</span><span class="o">();</span>    
                <span class="k">if</span> <span class="o">(</span><span class="n">visitUrl</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                    <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="n">RequestAndResponseTool</span><span class="o">.</span><span class="na">sendRequstAndGetResponse</span><span class="o">(</span><span class="n">visitUrl</span><span class="o">);</span>
                <span class="n">Elements</span> <span class="n">element</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getDoc</span><span class="o">().</span><span class="na">getLinks</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
                    <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">FileTool</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
                <span class="n">Links</span><span class="o">.</span><span class="na">addVisitedUrlSet</span><span class="o">(</span><span class="n">visitUrl</span><span class="o">);</span>
                <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">links</span> <span class="o">=</span> <span class="n">save</span><span class="o">(</span><span class="n">page</span><span class="o">,</span><span class="n">path</span><span class="o">);</span>    <span class="c1">//保存网页</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">link</span> <span class="o">:</span> <span class="n">links</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Links</span><span class="o">.</span><span class="na">addUnvisitedUrlQueue</span><span class="o">(</span><span class="n">link</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>终于写完啦，来看看最终<em>Spider</em>类的样子：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">org.jsoup.select.Elements</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Spider</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initCrawlerWithSeeds</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">seeds</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">seeds</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
        <span class="n">Links</span><span class="o">.</span><span class="na">addUnvisitedUrlQueue</span><span class="o">(</span><span class="n">seeds</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Page</span> <span class="n">page</span><span class="o">,</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getUrl</span><span class="o">();</span> <span class="c1">//把链接名作为文件名</span>
        <span class="n">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="err">“</span><span class="o">/</span><span class="err">”</span><span class="o">+</span><span class="n">fileName</span><span class="o">;</span> <span class="c1">//存放的地址</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span> <span class="c1">//获得内容</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">DataOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">)));</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
            <span class="o">}</span>
            <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件"</span><span class="o">+</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s">"已经存放在"</span><span class="o">+</span> <span class="n">filePath</span>  <span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLinks</span><span class="o">(</span><span class="n">Page</span> <span class="n">page</span><span class="o">){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">links</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">;</span> 
        <span class="n">Elements</span> <span class="n">element</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="na">getDoc</span><span class="o">().</span><span class="na">select</span><span class="o">(</span><span class="s">"img[src]"</span><span class="o">);</span>      
        <span class="n">Iterator</span> <span class="n">iterator</span>  <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span> 
            <span class="n">Element</span> <span class="n">element</span> <span class="o">=</span> <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"element.text() get:"</span><span class="o">+</span><span class="n">element</span><span class="o">.</span><span class="na">text</span><span class="o">()+</span><span class="s">":"</span><span class="o">+</span><span class="n">element</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"abs:src"</span><span class="o">));</span>
            <span class="n">links</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"abs:src"</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">links</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">crawling</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">seeds</span><span class="o">,</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initCrawlerWithSeeds</span><span class="o">(</span><span class="n">seeds</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">Links</span><span class="o">.</span><span class="na">unVisitedUrlQueueIsEmpty</span><span class="o">()</span>  <span class="o">&amp;&amp;</span> <span class="n">Links</span><span class="o">.</span><span class="na">getVisitedUrlNum</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>  
            <span class="k">try</span><span class="o">{</span>
                <span class="n">String</span> <span class="n">visitUrl</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">Links</span><span class="o">.</span><span class="na">removeHeadOfUnVisitedUrlQueue</span><span class="o">();</span>    
                <span class="k">if</span> <span class="o">(</span><span class="n">visitUrl</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                    <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="n">RequestAndResponseTool</span><span class="o">.</span><span class="na">sendRequstAndGetResponse</span><span class="o">(</span><span class="n">visitUrl</span><span class="o">);</span>
                <span class="n">Elements</span> <span class="n">element</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getDoc</span><span class="o">().</span><span class="na">getLinks</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
                    <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">FileTool</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
                <span class="n">Links</span><span class="o">.</span><span class="na">addVisitedUrlSet</span><span class="o">(</span><span class="n">visitUrl</span><span class="o">);</span>
                <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">links</span> <span class="o">=</span> <span class="n">save</span><span class="o">(</span><span class="n">page</span><span class="o">,</span><span class="n">path</span><span class="o">);</span>    <span class="c1">//保存网页</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">link</span> <span class="o">:</span> <span class="n">links</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Links</span><span class="o">.</span><span class="na">addUnvisitedUrlQueue</span><span class="o">(</span><span class="n">link</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Spider</span> <span class="n">crawler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Spider</span><span class="o">();</span>
        <span class="n">crawler</span><span class="o">.</span><span class="na">crawling</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">"https://www.ustc.edu.cn/"</span><span class="o">},</span><span class="s">"clawer_file"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>爬取地址设置的是中国科学技术大学官网首页，存储地址在clawer_file文件夹中</p>


    <div class="ui horizontal divider">
        Thank You For Reading
    </div>
</div>
        </main>
    </div>
    
    <footer>
    <div class="footer-wrapper">
        <div class="ui secondary menu inverted">
            <div class="right menu">
                <a class="item" href="#">
                    Twitter
                </a>
                <a class="item" href="#">
                    Github
                </a>
            </div>
        </div>
    </div>
</footer>
<script type="text/javascript" src="/hly.github-io/assets/js/main.js"></script>
<script type="text/javascript" src="/hly.github-io/assets/js/vendor/jquery.min.js"></script>
<script type="text/javascript" src="/hly.github-io/assets/js/vendor/semantic.min.js"></script>

    <script src="/hly.github-io/assets/js/vendor/jquery.min.js"></script>
    <script src="/hly.github-io/assets/js/vendor/semantic.min.js"></script>
    <script type="/hly.github-io/assets/js/main.js"></script>
</body>

</html>